<!DOCTYPE html>
<html lang="pt-br">

<head>
    <link rel="shortcut icon" href="../assets/icon/favicon.ico" type="image/x-icon">
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MUsic | As Melhores</title>

    <link rel="stylesheet" href="../css/style.css">
    <link rel="stylesheet" href="dashboards.css">

    <script src="../js/funcoes.js"></script>
</head>

<body onload="validarSessao(), atualizacaoPeriodica()"> 
    
    <div class="header" id="Cabecalho">
        <div class="container">
            <div class="logo">
                <a href="../index.html">
                    <img src="../assets/imgs/Logo-Dark.png" width="200px" height="54px">
                </a>
            </div>

            <ul class="navbar">
                <li><a class="a1" href="../simulador.html">Votação</a></li>
                <li><a class="a1" href="./mural.html">Playlists</a></li>
                <li><a class="a1" href="#">Ranking</a></li>
            </ul>
            <a class="btn-ext" href="../index.html" onclick="limparSessao()"><u>Sair</u></a>
        </div>
    </div>

        <div class="corpo">
            <div class="container-c">
                <div class="card_ranking">
                    <canvas class="graph" id="myChart"></canvas>
                </div>
            </div>
        </div>
<!-- rodapé -->
        <div class="rodape">
            <div class="container_rodape">
                <div class="contato">
                    
                </div>
            </div>
        </div>

</body>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    const labels = [
      'Musica 1',
      'Musica 2',
      'Musica 3',
      'Musica 4',
      'Musica 5',
    ];
  
    const data = {
      labels: labels,
      datasets: [{
        label: 'My First dataset',
        backgroundColor: 'rgb(255, 99, 132)',
        borderColor: 'rgb(255, 99, 132)',
        data: [15, 10, 5, 2, 20, 30, 50],
      }]
    };
  
    const config = {
      type: 'bar',
      data: data,
      options: {}
    };
</script>
<script>
    const myChart = new Chart(
      document.getElementById('myChart'),
      config
    );
</script>
  
<script>
    

    function atualizacaoPeriodica() {
        obterdados(1);
        obterdados(2);
        obterdados(3);
        obterdados(4);

        function sendData() {
			var http = new XMLHttpRequest();
			http.open('POST', 'http://localhost:3000/api/sendData', false);
			http.send(null);
		}

        setInterval(() => {
			sendData();
		}, 2000);
        setTimeout(atualizacaoPeriodica, 5000);
    }

    function obterdados(idAquario) {
        fetch(`/medidas/tempo-real/${idAquario}`)
            .then(resposta => {

                if (resposta.ok) {
                    resposta.json().then(resposta => {

                        console.log(`Dados recebidos: ${JSON.stringify(resposta)}`);

                        var dados = {
                            temperatura: resposta[0].temperatura,
                        }

                        alertar(resposta[0].temperatura, idAquario);
                    });
                } else {

                    console.error('Nenhum dado encontrado ou erro na API');
                }
            })
            .catch(function (error) {
                console.error(`Erro na obtenção dos dados do aquario p/ gráfico: ${error.message}`);
            });

    }

</script>

</html>